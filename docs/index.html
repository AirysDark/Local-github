<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Local-github Builder</title>
<style>
  :root{
    --bg:#0b1118; --panel:#0f1622; --panel-2:#121c2a; --ink:#e6eef8; --muted:#97a8be;
    --brand:#55c2ff; --ok:#67e8a6; --warn:#ffd166; --line:#1a2636; --chip:#0d2136;
    --ring: 0 0 0 2px rgba(85,194,255,.25),0 0 0 6px rgba(85,194,255,.08);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Inter,Arial;
    color:var(--ink); background:radial-gradient(1200px 700px at 80% -10%,#0e1a2b,transparent),
                       radial-gradient(900px 500px at -10% 120%,#0e2338,transparent),
                       var(--bg);
  }
  .wrap{max-width:1100px; margin:28px auto; padding:0 18px;}
  .hero{
    display:flex; align-items:center; justify-content:space-between; gap:16px;
    background:linear-gradient(180deg,rgba(85,194,255,.08),transparent),var(--panel);
    border:1px solid var(--line); border-radius:16px; padding:18px 18px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.03), 0 10px 30px rgba(0,0,0,.25);
  }
  .title{display:flex; align-items:center; gap:12px}
  .logo{
    width:40px; height:40px; border-radius:12px; display:grid; place-items:center;
    background:conic-gradient(from 210deg,#1a6ea7,#55c2ff,#1a6ea7);
    box-shadow:0 6px 18px rgba(85,194,255,.25),inset 0 0 10px rgba(255,255,255,.08);
  }
  .title h1{margin:0; font-weight:700; letter-spacing:.2px}
  .sub{margin:4px 0 0 0; color:var(--muted); font-size:13px}
  .grid{display:grid; gap:16px; grid-template-columns: 1fr 1fr}
  @media (max-width:920px){ .grid{grid-template-columns:1fr} }
  .card{
    background:linear-gradient(180deg,rgba(255,255,255,.02),transparent),var(--panel);
    border:1px solid var(--line); border-radius:16px; padding:16px;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
  }
  .card h3{margin:0 0 6px 0; font-size:16px; letter-spacing:.2px}
  .hint{color:var(--muted); font-size:12px; margin-top:6px}
  label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}
  input,select{
    width:100%; background:var(--panel-2); color:var(--ink);
    border:1px solid var(--line); border-radius:10px; padding:10px 12px;
    outline:none; transition:.2s border-color, .2s box-shadow;
  }
  input:focus,select:focus{ border-color:var(--brand); box-shadow:var(--ring); }
  .row2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  @media (max-width:620px){ .row2{grid-template-columns:1fr} }
  .btn{
    display:inline-flex; align-items:center; gap:10px; cursor:pointer;
    background:linear-gradient(180deg,#62d1ff,#55c2ff);
    color:#042032; border:0; border-radius:12px; padding:12px 14px; font-weight:700;
    box-shadow:0 10px 26px rgba(85,194,255,.35), inset 0 1px 0 rgba(255,255,255,.25);
  }
  .btn:hover{filter:brightness(1.05)}
  .btn:active{transform:translateY(1px)}
  .out{
    background:var(--panel-2); border:1px solid var(--line); border-radius:12px;
    padding:12px; white-space:pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    min-height:90px;
  }
  .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .chip{
    font-size:12px; padding:6px 8px; border-radius:999px; background:var(--chip);
    border:1px solid var(--line); color:var(--muted);
  }
  .kbd{background:#0e2135; border:1px solid #1c314a; padding:2px 6px; border-radius:6px}
  .footer-note{color:var(--muted); font-size:12px; margin-top:6px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="title">
        <div class="logo" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="#001420">
            <path d="M13 3a9 9 0 1 0 8.485 6H19a7 7 0 1 1-2.05-4.95L15 6h6V0l-2.293 2.293A8.962 8.962 0 0 0 13 3z"/>
          </svg>
        </div>
        <div>
          <h1>Local-github Builder</h1>
          <div class="sub">All options. Dynamic dropdowns from <span class="kbd">config/options.json</span>. No hidden requests.</div>
        </div>
      </div>
      <div class="chips">
        <span class="chip">Raspberry Pi</span>
        <span class="chip">Headless</span>
        <span class="chip">Workflow Dispatch</span>
      </div>
    </div>

    <!-- Build target + User -->
    <div class="grid" style="margin-top:16px">
      <div class="card">
        <h3>Build target</h3>
        <div class="row2">
          <div>
            <label>Build type</label>
            <select id="build_type">
              <option value="pi" selected>pi</option>
              <option value="pi-zero">pi-zero</option>
              <option value="pi-2">pi-2</option>
              <option value="pi-3">pi-3</option>
              <option value="pi-4">pi-4</option>
              <option value="pi-5">pi-5</option>
              <option value="pc">pc</option>
              <option value="x86_64">x86_64</option>
              <option value="i386">i386</option>
              <option value="armhf-generic">armhf-generic</option>
              <option value="arm64-generic">arm64-generic</option>
              <option value="riscv64-generic">riscv64-generic</option>
              <option value="jetson">jetson</option>
              <option value="rockchip">rockchip</option>
              <option value="allwinner">allwinner</option>
              <option value="amlogic">amlogic</option>
              <option value="beaglebone">beaglebone</option>
              <option value="odroid">odroid</option>
              <option value="pine64">pine64</option>
              <option value="nanopi">nanopi</option>
              <option value="bananapi">bananapi</option>
              <option value="orangepi">orangepi</option>
              <option value="imx6">imx6</option>
              <option value="imx8">imx8</option>
              <option value="qemu">qemu</option>
              <option value="virtualbox">virtualbox</option>
              <option value="vmware">vmware</option>
              <option value="chromebook">chromebook</option>
              <option value="android-aosp">android-aosp</option>
              <option value="android-lineage">android-lineage</option>
            </select>
          </div>
          <div>
            <label>CPU bitrate</label>
            <select id="cpu_bitrate">
              <option value="64bit" selected>64bit</option>
              <option value="32bit">32bit</option>
            </select>
          </div>
        </div>
        <div class="hint">`target_bits` is computed as <span class="kbd">"&lt;build_type&gt; &lt;cpu_bitrate&gt;"</span> (e.g., <span class="kbd">pi 64bit</span>).</div>
      </div>

      <div class="card">
        <h3>User</h3>
        <label>Username</label>
        <input id="user_name" placeholder="e.g. AirysDark" />
        <label>Password</label>
        <input id="user_password" type="password" placeholder="e.g. ••••••••" />
      </div>
    </div>

    <!-- Wi-Fi + SSH -->
    <div class="grid" style="margin-top:16px">
      <div class="card">
        <h3>Wi-Fi</h3>
        <label>SSID</label>
        <input id="wifi_ssid" placeholder="e.g. Raspbain" />
        <label>Password</label>
        <input id="wifi_password" type="password" placeholder="e.g. ••••••••" />
        <div class="row2">
          <div>
            <label>Static IPv4</label>
            <input id="static_ip" placeholder="192.168.0.8" />
          </div>
          <div>
            <label>Gateway IPv4</label>
            <input id="gateway" placeholder="192.168.0.1" />
          </div>
        </div>
        <label>DNS servers</label>
        <input id="dns" placeholder="1.1.1.1;8.8.8.8" />
      </div>

      <div class="card">
        <h3>SSH</h3>
        <div class="hint">Use <code class="kbd">yes</code>, <code class="kbd">no</code>, or <code class="kbd">prohibit-password</code>.</div>
        <label>PermitRootLogin</label>
        <select id="ssh_prl">
          <option value="yes">yes</option>
          <option value="no">no</option>
          <option value="prohibit-password">prohibit-password</option>
        </select>

        <label>PasswordAuthentication</label>
        <select id="ssh_pa">
          <option value="yes">yes</option>
          <option value="no">no</option>
        </select>

        <label>PubkeyAuthentication</label>
        <select id="ssh_pk">
          <option value="yes">yes</option>
          <option value="no">no</option>
        </select>
      </div>
    </div>

    <!-- Region -->
    <div class="card" style="margin-top:16px">
      <h3>Region &amp; Locale</h3>
      <label>Wi-Fi country</label>
      <select id="wifi_country"></select>

      <label>Timezone</label>
      <select id="timezone"></select>

      <label>Keyboard layout</label>
      <select id="keyboard" onchange="toggleKeyboardCustom()"></select>

      <label id="kb_custom_label" style="display:none">Custom layout
        <input id="keyboard_custom" placeholder="e.g. us,intl" />
      </label>
      <div class="hint">Lists load from <span class="kbd">options.json</span> (`wifi_countries`/`country`, `timezones`/`tz`, `keyboards`/`kbd`).</div>
    </div>

    <!-- Build -->
    <div class="card" style="margin-top:16px">
      <div class="row2">
        <div>
          <button class="btn" id="buildBtn" type="button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="#012233" aria-hidden="true"><path d="M13 3a9 9 0 1 0 8.485 6H19a7 7 0 1 1-2.05-4.95L15 6h6V0l-2.293 2.293A8.962 8.962 0 0 0 13 3z"/></svg>
            Show build payload
          </button>
          <div class="footer-note">This page <strong>does not send</strong> anything. Copy the curl and run it locally.</div>
        </div>
        <div>
          <label>Personal Access Token (optional; used only in the curl shown below)</label>
          <input id="token" type="password" placeholder="ghp_… (NOT sent by this page)"/>
        </div>
      </div>

      <h3 style="margin-top:16px">workflow_dispatch JSON</h3>
      <div id="jsonOut" class="out">Click “Show build payload”.</div>

      <h3 style="margin-top:16px">curl command (copy &amp; run locally)</h3>
      <div id="curlOut" class="out">—</div>

      <h3 style="margin-top:16px">Endpoint</h3>
      <div id="repoOut" class="out">https://api.github.com/repos/OWNER/REPO/actions/workflows/.github/workflows/build.yml/dispatches</div>

      <div class="hint" style="margin-top:8px">
        Note: GitHub’s <code class="kbd">workflow_dispatch</code> allows max <strong>10</strong> inputs. If your workflow has more,
        either (A) accept fewer inputs here and load the rest from <span class="kbd">options.json</span> inside the workflow, or
        (B) use a single packed input (e.g., base64 JSON) and unpack in the workflow.
      </div>
    </div>
  </div>

<script>
function targetBitsComputed(){
  return document.getElementById('build_type').value + ' ' + document.getElementById('cpu_bitrate').value;
}
function toggleKeyboardCustom(){
  const val = document.getElementById('keyboard').value;
  document.getElementById('kb_custom_label').style.display = (val === 'custom') ? 'block' : 'none';
}
function gatherInputs(){
  return {
    target_bits: targetBitsComputed(),
    user_name: document.getElementById('user_name').value,
    user_password: document.getElementById('user_password').value,
    wifi_ssid: document.getElementById('wifi_ssid').value,
    wifi_password: document.getElementById('wifi_password').value,
    ssh_permit_root_login: document.getElementById('ssh_prl').value,
    ssh_password_auth: document.getElementById('ssh_pa').value,
    ssh_pubkey_auth: document.getElementById('ssh_pk').value,
    static_ip: document.getElementById('static_ip').value,
    gateway: document.getElementById('gateway').value,
    dns: document.getElementById('dns').value,
    wifi_country: document.getElementById('wifi_country').value,
    timezone: document.getElementById('timezone').value,
    keyboard: document.getElementById('keyboard').value,
    keyboard_custom: document.getElementById('keyboard_custom').value
  };
}
function showPayload(){
  const ref = "main";
  const body = { ref, inputs: gatherInputs() };

  const token = (document.getElementById('token').value || '').trim();
  const endpoint = `https://api.github.com/repos/OWNER/REPO/actions/workflows/.github/workflows/build.yml/dispatches`;

  document.getElementById('jsonOut').textContent = JSON.stringify(body, null, 2);
  document.getElementById('repoOut').textContent = endpoint;

  const authHeader = token ? `  -H "Authorization: Bearer ${token}" \\` : '  # -H "Authorization: Bearer <TOKEN>" \\';
  const curl = [
    'curl -s -X POST \\',
    '  -H "Accept: application/vnd.github+json" \\',
    '  -H "X-GitHub-Api-Version: 2022-11-28" \\',
     authHeader,
     '  ' + endpoint + ' \\',
    "  -d '" + JSON.stringify(body).replace(/'/g,"'\"'\"'") + "'"
  ].join('\\\n').replace(/\\\\n/g,'\n');
  document.getElementById('curlOut').textContent = curl;
}
document.getElementById('buildBtn').addEventListener('click', showPayload);

const embeddedFallback = {
  defaults:{
    build_type:"pi", cpu_bitrate:"64bit",
    user_name:"", user_password:"",
    wifi_ssid:"", wifi_password:"",
    ssh_permit_root_login:"yes", ssh_password_auth:"yes", ssh_pubkey_auth:"yes",
    static_ip:"", gateway:"", dns:"",
    wifi_country:"AU", timezone:"Australia/Sydney", keyboard:"us", keyboard_custom:""
  },
  wifi_countries:["AU","US","GB","NZ","CA"],
  timezones:["Australia/Sydney","UTC","Europe/London","America/New_York"],
  keyboards:["au","us","gb","us(intl)","custom"]
};

function normalizeOptions(js){
  const countries = (js.wifi_countries || js.country || []);
  const zones     = (js.timezones || js.tz || []);
  const kbs       = (js.keyboards || js.kbd || []);
  const d         = (js.defaults || {});

  return {
    d: Object.assign({}, embeddedFallback.defaults, d),
    countries: countries.length ? countries : embeddedFallback.wifi_countries,
    zones:     zones.length     ? zones     : embeddedFallback.timezones,
    kbs:       kbs.length       ? kbs       : embeddedFallback.keyboards
  };
}

function setVal(id, val){ const el=document.getElementById(id); if(el) el.value = (val ?? ""); }

async function loadOptions(){
  // Try to fetch config/options.json (works on Pages); fallback if not present
  const urls = ['config/options.json','./config/options.json','/config/options.json'];
  let js=null, ok=false;
  for (const u of urls){
    try{ const r=await fetch(u,{cache:'no-store'}); if(r.ok){ js=await r.json(); ok=true; break; } }catch(e){}
  }
  if(!ok){ js = embeddedFallback; }

  const opts = normalizeOptions(js);

  // Populate Region & Locale dropdowns
  const fill = (id, arr)=> {
    const el = document.getElementById(id);
    el.innerHTML = '';
    arr.forEach(v=>{
      const o=document.createElement('option'); o.value=v; o.textContent=v; el.appendChild(o);
    });
  };
  fill('wifi_country', opts.countries);
  fill('timezone', opts.zones);
  fill('keyboard', opts.kbs);

  // Apply defaults
  setVal('build_type', opts.d.build_type);
  setVal('cpu_bitrate', opts.d.cpu_bitrate);
  setVal('user_name', opts.d.user_name);
  setVal('user_password', opts.d.user_password);
  setVal('wifi_ssid', opts.d.wifi_ssid);
  setVal('wifi_password', opts.d.wifi_password);
  setVal('ssh_prl', opts.d.ssh_permit_root_login);
  setVal('ssh_pa',  opts.d.ssh_password_auth);
  setVal('ssh_pk',  opts.d.ssh_pubkey_auth);
  setVal('static_ip', opts.d.static_ip);
  setVal('gateway',   opts.d.gateway);
  setVal('dns',       opts.d.dns);
  setVal('wifi_country', opts.d.wifi_country);
  setVal('timezone',     opts.d.timezone);
  setVal('keyboard',     opts.d.keyboard);
  setVal('keyboard_custom', opts.d.keyboard_custom);
  toggleKeyboardCustom();
}

loadOptions();
</script>
</body>
</html>
